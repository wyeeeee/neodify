# Neodify 前端界面草图（MVP）

本文基于当前后端能力（`/auth`、`/agents`、`/skills`、`/mcps`、`/runs`、`/ws/runs/:runId`）给出前端首版信息架构与低保真线框图，便于你直接进入实现阶段。

## 1. 信息架构（建议路由）

- `/login`：登录页
- `/console`：运行控制台（发起 invoke + 实时事件）
- `/runs/:runId`：运行详情页（事件流、结果、原始 JSON）
- `/agents`：Agent 管理
- `/skills`：Skill 管理（列表 + 编辑 + 预览）
- `/mcps`：MCP 管理

---

## 2. 全局布局（登录后）

```text
┌──────────────────────────────────────────────────────────────────────────────┐
│ TopBar: Neodify | 环境: dev/prod | 当前用户 admin | 退出登录               │
├──────────────┬───────────────────────────────────────────────────────────────┤
│ Sidebar      │ Main Content                                                  │
│ - 运行控制台 │ (按路由切换页面)                                              │
│ - Agent管理  │                                                               │
│ - Skill管理  │                                                               │
│ - MCP管理    │                                                               │
└──────────────┴───────────────────────────────────────────────────────────────┘
```

---

## 3. 页面草图

### 3.1 登录页 `/login`

```text
┌──────────────────────────────────────────────┐
│ NEODIFY CONTROL                              │
│ 单用户登录                                   │
│ 使用后端 .env 中账号密码                     │
│                                              │
│ 账号 [__________________________]            │
│ 密码 [__________________________]            │
│                                              │
│ [ 登录 ]                                     │
│ 错误提示：账号或密码错误                     │
└──────────────────────────────────────────────┘
```

要点：
- 成功后保存 `token/expiresAt/username` 到本地。
- 首屏校验 token 失效则强制回登录。

### 3.2 运行控制台 `/console`

```text
┌──────────────────────────────────────────────────────────────────────────────┐
│ 运行控制台                                                                  │
├───────────────────────────────┬──────────────────────────────────────────────┤
│ 左侧：调用面板                 │ 右侧：实时事件流                             │
│ Agent [v agent-main]          │ RunId: run_xxx  状态: running/completed      │
│ ConversationId [可空]         │ ------------------------------------------   │
│ ConversationTitle [可空]      │ [1] run.started                               │
│ Prompt                        │ [2] agent.resolved                            │
│ ┌───────────────────────────┐ │ [3] agent.tool.call (Bash)                    │
│ │ 请总结这段日志...         │ │ [4] agent.tool.result                         │
│ └───────────────────────────┘ │ [5] run.completed                              │
│ Metadata(JSON)               │                                              │
│ [ 发起调用 ] [ 清空 ]         │ 底部：WS连接状态 ●已连接 / ○重连中             │
└───────────────────────────────┴──────────────────────────────────────────────┘
```

要点：
- 发起 `POST /runs/invoke` 后立即显示 `runId`。
- 自动连接 `GET /ws/runs/:runId`（WebSocket）。
- 支持跳转“查看详情”。

### 3.3 运行详情页 `/runs/:runId`

```text
┌──────────────────────────────────────────────────────────────────────────────┐
│ 运行详情 run_xxx          [返回控制台] [刷新]                                │
├──────────────────────────────────────────────────────────────────────────────┤
│ 基本信息：agentId | conversationId | status | startedAt | latency | cost     │
├──────────────────────────────────────────────────────────────────────────────┤
│ Tabs: [时间线] [结果输出] [原始JSON]                                         │
│                                                                              │
│ 时间线: run.started -> ... -> run.completed                                  │
│ 结果输出: outputJson.text / structuredOutput                                 │
│ 原始JSON: run + events 完整展开                                              │
└──────────────────────────────────────────────────────────────────────────────┘
```

要点：
- 主数据来自 `GET /runs/:runId`。
- 时间格式统一本地化显示；保留原始毫秒时间戳。

### 3.4 Agent 管理页 `/agents`

```text
┌──────────────────────────────────────────────────────────────────────────────┐
│ Agent 管理                                       [新建 Agent]                │
├──────────────────────────────────────────────────────────────────────────────┤
│ 列表：ID | 名称 | 模型 | MaxTokens | 启用状态 | 操作                          │
│ agent-main | 主Agent | claude-sonnet-4-5 | 4000 | enabled | 编辑             │
├──────────────────────────────────────────────────────────────────────────────┤
│ 抽屉/弹窗：新建/编辑                                                        │
│ - id, name, enabled                                                         │
│ - model, systemPromptMd, temperature, maxTokens                             │
│ - skillIds(多选), mcpIds(多选)                                              │
│ - [保存] [取消]                                                              │
└──────────────────────────────────────────────────────────────────────────────┘
```

### 3.5 Skill 管理页 `/skills`

```text
┌──────────────────────────────────────────────────────────────────────────────┐
│ Skill 管理     [本地同步] [新建Skill]                                        │
├───────────────────────┬──────────────────────────────────────────────────────┤
│ 左：Skill列表          │ 右：编辑区                                           │
│ - writer (enabled)    │ 名称 [代码助手]                                       │
│ - magic-script (...)  │ 状态 [启用 v]                                         │
│                       │ Markdown编辑器（SKILL.md）                            │
│                       │ -----------------------------------                   │
│                       │ # Skill ...                                            │
│                       │ -----------------------------------                   │
│                       │ 预览面板（Markdown Render + 代码高亮）                │
│                       │ [保存内容] [新建]                                     │
└───────────────────────┴──────────────────────────────────────────────────────┘
```

要点：
- 列表来自 `GET /skills`。
- 内容更新走 `PUT /skills/:skillId/content`。
- “本地同步”按钮触发 `POST /skills/sync`。

### 3.6 MCP 管理页 `/mcps`

```text
┌──────────────────────────────────────────────────────────────────────────────┐
│ MCP 管理                                         [新建 MCP]                  │
├──────────────────────────────────────────────────────────────────────────────┤
│ 列表：ID | 名称 | mode(http/sse/uvx/npx) | 启用状态 | 操作                    │
├──────────────────────────────────────────────────────────────────────────────┤
│ 抽屉/弹窗：                                                                │
│ - 基础：id, name, enabled, mode                                             │
│ - mode=http/sse：endpoint, headers                                           │
│ - mode=uvx/npx：command, args[], env{}                                       │
│ - authConfig{}, timeoutMs                                                    │
│ - [保存]                                                                     │
└──────────────────────────────────────────────────────────────────────────────┘
```

---

## 4. 关键状态与交互规范

- 加载态：表格 skeleton + 按钮 loading，避免空白闪屏。
- 空态：提供明确 CTA（如“新建 Agent”“发起第一次运行”）。
- 错误态：顶部 toast + 就近错误文案（字段级）。
- 实时态：WS 断线自动重连（指数退避），显示连接状态。
- 安全态：401 自动清理本地 token 并跳转 `/login`。

---

## 5. 实施优先级（建议）

1. 登录态守卫 + 全局布局（Sidebar/TopBar）。
2. 运行控制台（invoke + WS 事件流）。
3. Run 详情页（查询与展示）。
4. Agent/Skill/MCP 三个管理页。

这样可以先打通“可调用、可观测”，再补齐“可配置”。

